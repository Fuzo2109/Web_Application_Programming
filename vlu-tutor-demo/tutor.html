<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutor Dashboard - VLU Tutor System</title>
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/tutor-theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div style="display: flex; min-height: 100vh; background: #f8fafc;">
    <div class="sidebar">
      <div class="user-info">
        <div class="user-logo"><i class="fas fa-chalkboard-teacher"></i></div>
        <div class="user-name">Nguyen Van B</div>
        <div class="user-id">Tutor ID: T123456</div>
      </div>
      <div class="sidebar-menu">
        <a href="#dashboard" class="active"><i class="fas fa-home"></i><span>Dashboard</span></a>
        <a href="#create-class"><i class="fas fa-plus-circle"></i><span>Create Lesson</span></a>
        <a href="#my-classes"><i class="fas fa-list"></i><span>My Classes</span></a>
        <a href="#schedule"><i class="fas fa-calendar-alt"></i><span>Teaching Schedule</span></a>
        <a href="#edit-profile"><i class="fas fa-user-edit"></i><span>Edit Profile</span></a>
        <a href="#logout"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
      </div>
    </div>
    <div class="main-content">
      <div class="header-bar" style="background:#fff;box-shadow:0 2px 12px rgba(56,142,60,0.06);padding:0 32px;height:68px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10;">
        <div class="header-left" style="display:flex;align-items:center;gap:18px;">
          <div class="header-logo" style="width:44px;height:44px;border-radius:12px;background:var(--main-gradient);display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.7rem;font-weight:bold;">
            <i class="fas fa-chalkboard-teacher"></i>
          </div>
          <span class="header-tutor" style="font-size:1.15rem;font-weight:600;color:var(--main-color);">Tutor Dashboard</span>
        </div>
        <div class="header-right" style="display:flex;align-items:center;gap:18px;">
          <div class="header-notify" style="font-size:1.5rem;color:var(--main-color);background:#e8f5e9;border-radius:50%;width:38px;height:38px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;">
            <i class="fas fa-bell"></i>
          </div>
          <div class="header-avatar" style="width:44px;height:44px;border-radius:50%;background:#e8f5e9;display:flex;align-items:center;justify-content:center;font-size:1.3rem;color:var(--main-color);border:2px solid #e8f5e9;">
            <i class="fas fa-chalkboard-teacher"></i>
          </div>
        </div>
      </div>
      <div class="dashboard-section" id="tutorMainContent" style="max-width:1200px;margin:32px auto 0 auto;padding:0 24px;">
        <!-- Dynamic content will be rendered here -->
      </div>
    </div>
  </div>

  <script>
    // State demo
    let myClasses = [
      { id: 1, name: 'Math 101', subject: 'Mathematics', status: 'pending', students: [ {name: 'Nguyen Van A', approved: false} ] },
      { id: 2, name: 'Physics 201', subject: 'Physics', status: 'approved', students: [ {name: 'Le Thi B', approved: true} ] },
      { id: 3, name: 'English 301', subject: 'English', status: 'approved', students: [ {name: 'Tran Van C', approved: true} ] },
      { id: 4, name: 'Biology 101', subject: 'Biology', status: 'pending', students: [ {name: 'Pham Thi D', approved: false} ] },
      { id: 5, name: 'Chemistry 202', subject: 'Chemistry', status: 'approved', students: [ {name: 'Nguyen Van E', approved: true} ] },
      { id: 6, name: 'History 101', subject: 'History', status: 'pending', students: [ {name: 'Le Thi F', approved: false} ] }
    ];
    
    let schedule = [
      { className: 'Physics 201', subject: 'Physics', time: 'Mon 10:00-12:00', students: ['Le Thi B'] },
      { className: 'Database Systems', subject: 'Computer Science', time: 'Tue 13:00-15:00', students: ['Tran Van C'] },
      { className: 'Linear Algebra', subject: 'Mathematics', time: 'Wed 08:00-10:00', students: ['Pham Thi D'] },
      { className: 'Marketing Principles', subject: 'Economics', time: 'Fri 14:00-16:00', students: ['Nguyen Van E'] }
    ];

    // Sidebar navigation
    const menuLinks = document.querySelectorAll('.sidebar-menu a');
    menuLinks.forEach(link => {
      link.onclick = function(e) {
        e.preventDefault();
        menuLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        const href = link.getAttribute('href');
        switch(href) {
          case '#dashboard':
            renderTutorDashboard();
            break;
          case '#create-class':
            renderCreateClass();
            break;
          case '#my-classes':
            renderMyClasses();
            break;
          case '#schedule':
            renderSchedule();
            break;
          case '#edit-profile':
            renderEditProfile();
            break;
          case '#logout':
            window.location.href = 'login.html';
            break;
        }
      };
    });

    function renderTutorDashboard() {
      const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
      const weekSchedule = {};
      daysOfWeek.forEach(day => weekSchedule[day] = []);
      schedule.forEach(sch => {
        let day = daysOfWeek.find(d => sch.time && sch.time.toLowerCase().startsWith(d.slice(0,3).toLowerCase()));
        if(day) weekSchedule[day].push(sch);
      });
      let upcoming = schedule.slice().sort((a,b) => {
        const dayA = daysOfWeek.findIndex(d => a.time && a.time.toLowerCase().startsWith(d.slice(0,3).toLowerCase()));
        const dayB = daysOfWeek.findIndex(d => b.time && b.time.toLowerCase().startsWith(d.slice(0,3).toLowerCase()));
        if(dayA !== dayB) return dayA - dayB;
        return (a.time || '').localeCompare(b.time || '');
      });
      const content = `
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-chalkboard"></i></div>
            <div class="stat-info">
              <div class="stat-value">${myClasses.length}</div>
              <div class="stat-label">Total Classes</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-info">
              <div class="stat-value">${myClasses.reduce((sum, cls) => sum + cls.students.length, 0)}</div>
              <div class="stat-label">Total Students</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
            <div class="stat-info">
              <div class="stat-value">${schedule.length}</div>
              <div class="stat-label">Scheduled Lessons</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-clock"></i></div>
            <div class="stat-info">
              <div class="stat-value">${myClasses.filter(c => c.status === 'pending').length}</div>
              <div class="stat-label">Pending Approval</div>
            </div>
          </div>
        </div>
        <div class="dashboard-tutor-blocks">
          <div class="chart-section" style="margin-bottom:32px;">
            <div class="section-title">Weekly Teaching Schedule</div>
            <div class="calendar-container">
              <div class="calendar-grid">
                ${daysOfWeek.map(day => `
                  <div class="calendar-day">
                    <div class="calendar-day-label">${day}</div>
                    ${weekSchedule[day].length ? weekSchedule[day].map(sch => `
                      <div class="calendar-event">
                        <div class="calendar-event-title">${sch.className}</div>
                        <div class="calendar-event-time">${sch.time}</div>
                      </div>
                    `).join('') : '<div style="color: #bbb; font-size: 0.9rem; margin-top: 8px;">No classes</div>'}
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
          <div class="upcoming-section" style="margin-bottom:0;">
            <div class="section-title">Upcoming Lessons</div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
              ${upcoming.length ? upcoming.map(sch => `
                <div style="background: #f9f9f9; border-radius: 8px; padding: 12px; border-left: 4px solid var(--main-color); display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-weight: 600; color: var(--main-color);">${sch.className}</div>
                    <div style="font-size: 0.9rem; color: #666;">${sch.subject}</div>
                    <div style="font-size: 0.85rem; color: #888;">${sch.time}</div>
                  </div>
                  <button class="btn btn-primary" onclick="joinLesson('${sch.className}')">
                    <i class="fas fa-video"></i> Join
                  </button>
                </div>
              `).join('') : '<div style="color: #bbb;">No upcoming lessons.</div>'}
            </div>
          </div>
        </div>
        <style>
        .dashboard-tutor-blocks {
          display: flex;
          flex-direction: column;
          gap: 0;
          max-width: 900px;
          margin: 0 auto;
        }
        .chart-section, .upcoming-section {
          width: 100%;
          box-sizing: border-box;
        }
        </style>
      `;
      document.getElementById('tutorMainContent').innerHTML = content;
    }

    function renderCreateClass() {
      const content = `
        <div class="section-title">Create a New Lesson</div>
        <div class="chart-section" style="max-width: 600px;">
        <form class="create-class-form" id="createClassForm">
            <div class="form-group">
          <label>Lesson Name</label>
          <input type="text" name="className" required>
            </div>
            <div class="form-group">
          <label>Subject</label>
          <select name="subject" required>
            <option value="">Select subject</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Physics">Physics</option>
            <option value="Chemistry">Chemistry</option>
            <option value="English">English</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Biology">Biology</option>
            <option value="Economics">Economics</option>
          </select>
            </div>
            <div class="form-group">
          <label>Date</label>
          <input type="date" name="date" required>
            </div>
            <div class="form-group">
              <label>Time</label>
              <input type="time" name="time" required>
            </div>
            <div class="form-group">
              <label>Duration (hours)</label>
              <select name="duration">
                <option value="1">1 hour</option>
                <option value="1.5">1.5 hours</option>
                <option value="2">2 hours</option>
                <option value="3">3 hours</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Create Lesson</button>
        </form>
          <div id="createClassMsg" style="margin-top: 16px; color: var(--main-color); font-weight: 600;"></div>
        </div>
      `;
      document.getElementById('tutorMainContent').innerHTML = content;
      
      document.getElementById('createClassForm').onsubmit = function(e) {
        e.preventDefault();
        const form = e.target;
        const newClass = {
          id: Date.now(),
          name: form.className.value,
          subject: form.subject.value,
          date: form.date.value,
          time: form.time.value,
          duration: form.duration.value,
          status: 'pending',
          students: []
        };
        myClasses.push(newClass);
        document.getElementById('createClassMsg').textContent = 'Lesson created successfully! (Pending approval)';
        form.reset();
      };
    }

    function renderMyClasses() {
      const content = `
        <div class="section-title">My Classes</div>
        <div class="my-classes-grid">
          ${myClasses.length ? myClasses.slice().reverse().map(cls => `
            <div class="chart-section">
              <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 12px;">
                <div>
                  <h3 style="margin: 0 0 8px 0; color: var(--main-color);">${cls.name}</h3>
                  <div style="font-size: 0.9rem; color: #666; margin-bottom: 4px;">Subject: ${cls.subject}</div>
                  <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">Date: ${cls.date || 'Not set'}</div>
                  <span class="btn ${cls.status === 'pending' ? 'btn-warning' : 'btn-success'}" style="font-size: 0.8rem; padding: 4px 12px;">
                    ${cls.status === 'pending' ? 'Pending Approval' : 'Approved'}
                  </span>
                </div>
              </div>
              <div style="margin-top: 16px;">
                <h4 style="margin-bottom: 8px;">Students (${cls.students.length})</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                  ${cls.students.map(student => `
                    <span style="background: #f0f0f0; padding: 4px 12px; border-radius: 16px; font-size: 0.9rem;">${student.name}</span>
                  `).join('')}
                </div>
              </div>
            </div>
          `).join('') : '<div class="chart-section"><div style="color: #888; text-align: center;">No classes created yet.</div></div>'}
          </div>
        <style>
        .my-classes-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 24px;
        }
        @media (max-width: 900px) {
          .my-classes-grid { grid-template-columns: 1fr; }
        }
        </style>
      `;
      document.getElementById('tutorMainContent').innerHTML = content;
    }

    function renderSchedule() {
      // Demo time slots và days
      const days = [
        { label: 'Monday', color: '#e3ecfa' },
        { label: 'Tuesday', color: '#e3fae3' },
        { label: 'Wednesday', color: '#fae3e3' },
        { label: 'Thursday', color: '#f9f7e3' },
        { label: 'Friday', color: '#fae3f7' }
      ];
      const timeSlots = [
        '06:00–10:00', '10:00–14:00', '14:00–18:00', '18:00–22:00'
      ];
      // Tạo map: [time][day] = list lớp
      const scheduleMap = {};
      timeSlots.forEach(slot => { scheduleMap[slot] = {}; days.forEach(d => scheduleMap[slot][d.label] = []); });
      schedule.forEach(sch => {
        // Giả sử sch.time là "Mon 10:00-12:00" → lấy day và slot
        const dayIdx = days.findIndex(d => sch.time && sch.time.toLowerCase().startsWith(d.label.slice(0,3).toLowerCase()));
        if(dayIdx >= 0) {
          // Gán vào slot đầu tiên có thể (demo)
          scheduleMap[timeSlots[dayIdx % timeSlots.length]][days[dayIdx].label].push(sch);
        }
      });
      // Icon cho môn
      const subjectIcons = {
        'Mathematics': 'fa-square-root-alt',
        'Physics': 'fa-atom',
        'Computer Science': 'fa-laptop-code',
        'Economics': 'fa-chart-line',
        'Biology': 'fa-dna',
        'Chemistry': 'fa-flask',
        'English': 'fa-book-open',
        'History': 'fa-landmark'
      };
      let html = `
        <div style='font-size:1.3rem;font-weight:700;margin-bottom:18px;color:var(--main-color);display:flex;align-items:center;gap:18px;'>
          <span><i class='fas fa-calendar-alt'></i> Teaching Schedule</span>
        </div>
        <div style='max-width:1100px;margin:0 auto;padding:0 4px;'>
        <table class='weekly-lesson-table' style='width:100%;'>
          <thead>
            <tr>
              <th style='background:#fffbe6;color:#222;font-weight:700;'>TIME</th>
              ${days.map(day => `<th style='background:${day.color};color:#388e3c;font-weight:700;'>${day.label}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            ${timeSlots.map(slot => `
              <tr>
                <td style='font-weight:600;color:#388e3c;background:#f7fafd;'>${slot}</td>
                ${days.map(day => `
                  <td style='background:#fff;color:#333;padding:8px 4px;'>
                    ${scheduleMap[slot][day.label].length ? scheduleMap[slot][day.label].map(cls => `
                      <div class='lesson-card-modern'>
                        <div class='lesson-card-header'>
                          <i class='fas ${subjectIcons[cls.subject] || 'fa-book'} lesson-card-icon'></i>
                          <span class='lesson-card-title'>${cls.className}</span>
                        </div>
                        <div class='lesson-card-actions'>
                          <button class='join-btn-modern' onclick="joinLesson('${cls.className}')">
                            <i class='bi bi-camera-video'></i> Join
                          </button>
                          <button class='reschedule-btn-modern' onclick="openRescheduleModal('${cls.className}','${slot}','${day.label}')">
                            <i class='fas fa-calendar-alt'></i> Reschedule
                          </button>
                        </div>
                      </div>
                    `).join('') : ''}
                  </td>
                `).join('')}
              </tr>
            `).join('')}
          </tbody>
        </table>
        </div>
        <style>
        .weekly-lesson-table { border-collapse: separate; border-spacing: 0; width: 100%; margin-top: 8px; background: #fff; border-radius: 18px; overflow: hidden; box-shadow: 0 2px 12px rgba(56,142,60,0.07); }
        .weekly-lesson-table th, .weekly-lesson-table td { border: 1.5px solid #e3e3e3; padding: 8px 4px; text-align: left; font-size: 1rem; vertical-align: top; min-height: 60px; }
        .weekly-lesson-table th { text-align: center; font-size: 1.08rem; letter-spacing: 0.5px; }
        .weekly-lesson-table tr:hover td { background: #f0f7ff; }
        .weekly-lesson-table td { position: relative; overflow: visible; height: auto; }
        .lesson-card-modern {
            background: #e8f5e9;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(56,142,60,0.10);
            padding: 8px 10px 8px 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
            margin: 4px 0;
            width: 100%;
            min-width: 0;
            max-width: 100%;
            box-sizing: border-box;
        }
        .lesson-card-header {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 700;
            color: #388e3c;
            font-size: 1rem;
        }
        .lesson-card-icon {
            font-size: 1.1rem;
            color: #43a047;
        }
        .lesson-card-actions {
            display: flex;
            gap: 6px;
            margin-top: 2px;
        }
        .join-btn-modern {
            background: #388e3c;
            color: #fff;
            border: none;
            border-radius: 7px;
            padding: 6px 14px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.18s;
            display: flex; align-items: center; gap: 5px;
            box-shadow: 0 2px 8px rgba(56,142,60,0.10);
        }
        .join-btn-modern:hover { background: #2e7031; }
        .reschedule-btn-modern {
            background: #ffe082;
            color: #b11f24;
            border: none;
            border-radius: 7px;
            padding: 6px 14px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.18s;
            display: flex; align-items: center; gap: 5px;
            box-shadow: 0 2px 8px rgba(255,224,130,0.13);
        }
        .reschedule-btn-modern:hover { background: #ffecb3; color: #b11f24; }
        </style>
      `;
      document.getElementById('tutorMainContent').innerHTML = html;
    }

    function approveStudent(classId, studentIdx) {
          const cls = myClasses.find(c => c.id === classId);
      if (cls && cls.students[studentIdx]) {
            cls.students[studentIdx].approved = true;
        
        // Add to schedule if not exists
        if (!schedule.find(s => s.className === cls.name)) {
          schedule.push({
            className: cls.name,
            subject: cls.subject,
            time: `${new Date(cls.date).toLocaleDateString('en', {weekday: 'short'})} ${cls.time}`,
            students: [cls.students[studentIdx].name]
          });
            } else {
              const sch = schedule.find(s => s.className === cls.name);
          if (!sch.students.includes(cls.students[studentIdx].name)) {
            sch.students.push(cls.students[studentIdx].name);
          }
            }
        
            renderMyClasses();
          }
    }

    function joinLesson(className) {
          window.location.href = 'lesson.html';
    }

    // Thêm hàm renderEditProfile
    function renderEditProfile() {
      const content = `
        <div class="section-title">Edit Tutor Profile</div>
        <div class="chart-section" style="max-width: 800px;">
          <form id="editProfileForm">
            <div style="display:flex;align-items:center;gap:18px;margin-bottom:18px;">
              <div>
                <img id="avatarPreview" src="images/tutor1.jpg" alt="Avatar" style="width:72px;height:72px;border-radius:50%;object-fit:cover;border:2px solid #e3ecfa;">
              </div>
              <div>
                <input type="file" id="tutorAvatar" name="tutorAvatar" accept="image/*" style="margin-top:8px;">
                <div style="font-size:0.92rem;color:#888;">Click to change avatar</div>
              </div>
            </div>
            <div class="form-group">
              <label for="tutorName">Full Name</label>
              <input type="text" id="tutorName" name="tutorName" value="Nguyen Van B" required>
            </div>
            <div class="form-group">
              <label for="tutorId">Tutor ID</label>
              <input type="text" id="tutorId" name="tutorId" value="T123456" readonly>
            </div>
            <div class="form-group">
              <label for="tutorEmail">Email</label>
              <input type="email" id="tutorEmail" name="tutorEmail" value="tutor@vlu.edu.vn" required>
            </div>
            <div class="form-group">
              <label for="tutorPhone">Phone</label>
              <input type="text" id="tutorPhone" name="tutorPhone" value="0901234567">
            </div>
            <div class="form-group">
              <label for="tutorSubjects">Subjects</label>
              <select id="tutorSubjects" name="tutorSubjects" multiple style="height:90px;">
                <option value="Mathematics" selected>Mathematics</option>
                <option value="Physics" selected>Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="English">English</option>
                <option value="Computer Science">Computer Science</option>
                <option value="Biology">Biology</option>
                <option value="Economics">Economics</option>
                <option value="History">History</option>
              </select>
              <div style="font-size:0.92rem;color:#888;">Hold Ctrl (Windows) hoặc Cmd (Mac) để chọn nhiều môn</div>
            </div>
            <div class="form-group">
              <label for="tutorBio">Bio</label>
              <textarea id="tutorBio" name="tutorBio" rows="3">Experienced tutor in Mathematics and Physics.</textarea>
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </form>
          <div id="editProfileMsg" style="margin-top: 16px; color: var(--main-color); font-weight: 600;"></div>
        </div>
      `;
      document.getElementById('tutorMainContent').innerHTML = content;
      // Xem trước ảnh đại diện
      document.getElementById('tutorAvatar').onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(ev) {
            document.getElementById('avatarPreview').src = ev.target.result;
          };
          reader.readAsDataURL(file);
        }
      };
      document.getElementById('editProfileForm').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('editProfileMsg').textContent = 'Profile updated successfully!';
      };
    }

    // Initialize dashboard
    window.addEventListener('DOMContentLoaded', function() {
      renderTutorDashboard();
    });
  </script>
</body>
</html> 